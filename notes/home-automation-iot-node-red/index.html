<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="renderer" content="webkit">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <title>ESP 8266 based water controller - Coderhacks</title>
  
  <meta name="description" content="Home automation series part 1 As summers are nearing, wanted to go on vacation, now that I have couple of plants that need to be watered when I am on the move.. thought its a good usecase to be automated.
One option is to have timer which can switch on a valve once in a day, however due to power interruption It might loose track unless I build a battery backup for the controller.">
  <meta name="author" content="">
  
  <link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700,700i" rel="stylesheet">
  <link href="https://cdn.bootcss.com/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet">
  <link href="/css/style.css" rel="stylesheet">
  
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
  <link rel="icon" href="/img/favicon.ico">
  
  <meta name="generator" content="Hugo 0.39">
  
  <link rel="alternate" type="application/atom+xml" href="/index.xml" title="Coderhacks">
</head>
<body class="single">
  <header class="header">
    
    <p class="title"><a href="/"><span>Coderhacks</span></a></p>
    
    <button class="menu-toggle" type="button"></button>
    <nav class="menu">
      <ul>
        
        
      </ul>
    </nav>
  </header>
  <main class="main">

<article class="post post-view">
  <header class="post-header">
    <h1 class="post-title">ESP 8266 based water controller</h1>
    <p class="post-meta">22 Apr 2017</p>
  </header>
  <div class="post-content">

<h2 id="home-automation-series-part-1">Home automation series part 1</h2>

<p>As summers are nearing, wanted to go on vacation, now that I have couple of plants that need to be
watered when I am on the move.. thought its a good usecase to be automated.</p>

<p>One option is to have timer which can switch on a valve once in a day, however due to power interruption
   It might loose track unless I build a battery backup for the controller. Other option is to use Realtime
   clock module to refer and water the plants at specific timing.</p>

<p>Mean time I was checking on node red and IOT and why not build node red hub on Raspberry pi and have
   controller triggered by node red pipeline. Because its cool (unlike boring clock based implementation)
   I picked this up with wifi module that I already had (ESP 8266).</p>

<p>First I tried to use node mcu module based on ch340 ttl chip, however it seems getting this serial driver
   working on Mac or windows is a challenge. So I ordered a separate serial
   <a href="http://www.amazon.in/REES52-FT232RL-Download-Adapter-Arduino/dp/B00M1K412U/ref=sr_1_2?ie=UTF8&amp;qid=1494090823&amp;sr=8-2&amp;keywords=ttl">ttl module</a>
   this module works without any additional drivers on mac or windows.</p>

<p>However node-mcu has many digital pins, given that I have both ESP01 (which has no additional digital
   output) thought why not use it for this project. After briefly checking on internet got the following tasks</p>

<ul class="task-list">
<li><label><input type="checkbox" disabled class="task-list-item"> compile node-mcu firmare</label></li>
<li><label><input type="checkbox" disabled class="task-list-item"> Using ttl chip program ESP01</label></li>
<li><label><input type="checkbox" disabled class="task-list-item"> Prepare raspberry image with ssh<br /></label></li>
<li><label><input type="checkbox" disabled class="task-list-item"> Install node-red on raspberry and try out simple flow</label></li>
<li><label><input type="checkbox" checked disabled class="task-list-item"> Read about mqtt and figure out a server to run on raspberry

<ul class="task-list">
<li><label><input type="checkbox" disabled class="task-list-item"> Mosquitto seems to be good install service and configure service scripts to start on reboot</label></li>
<li><label><input type="checkbox" disabled class="task-list-item"> Test simple mqtt message and node-red flow</label></li>
</ul></label></li>
<li><label><input type="checkbox" disabled class="task-list-item"> Build the solenoid valve controller board</label></li>
<li><label><input type="checkbox" disabled class="task-list-item"> Write and upload program to listen to mqtt topic and switch on the valve
<br />
<br /></label></li>
</ul>

<p>ESP 8266 comes with firmware programmed to be controlled by AT commands. This is easy to
   get started with serial port, however needs microcontroller to use it in project. So node-mcu was
   appealing as one can program the esp chip and use micro controller in it. It used simple packed file
   system and executes init.lua on boot. There are many modules for controlling / interfacing with various
   modules. There are different versions of ESP modules available such as ESP-01 to 12 with different<br />
   spec.</p>

<p>to be continued &hellip;</p>
</div>
  <footer class="post-footer">
    
  </footer>
  
</article>
</main>
<footer class="footer">
  <span>&copy; 2017-2018 Coderhacks</span>
</footer>
<script src="https://cdn.bootcss.com/instantclick/3.0.1/instantclick.min.js" data-no-instant></script>
<script data-no-instant>InstantClick.init();</script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js" data-no-instant></script>
<script data-no-instant>
  hljs.initHighlightingOnLoad();
  menuToggle();
  InstantClick.on('change', function() {
    var blocks = document.querySelectorAll('pre code');
    for (var i = 0; i < blocks.length; i++) {
      hljs.highlightBlock(blocks[i]);
    }
    menuToggle();
  });
  function menuToggle() {
    var $toggle = document.querySelector('.menu-toggle');
    if (!$toggle.offsetParent) {
      return;
    }
    var $body = document.querySelector('body');
    $toggle.addEventListener('click', function() {
      $body.classList.toggle('noscroll');
    }, false);
  }
</script>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-98611610-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-98611610-1');
</script>

</body>
</html>

